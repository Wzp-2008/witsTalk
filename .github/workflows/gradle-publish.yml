# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
# This workflow will build a package using Gradle and then publish it to GitHub packages when a release is created
# For more information see: https://github.com/actions/setup-java/blob/main/docs/advanced-usage.md#Publishing-using-gradle

name: witsTalk action

on:
  push:
    branches:
      - witstalk-feature

jobs:
  backend:
    name: build witsTalk backend
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: '17'
          distribution: 'temurin'
      - name: Validate Gradle wrapper
        uses: gradle/wrapper-validation-action@ccb4328a959376b642e027874838f60f8e596de3
      - name: Run the Gradle package task
        uses: gradle/gradle-build-action@749f47bda3e44aa060e82d7b3ef7e40d953bd629
        with:
          arguments: lib-main:bootjar
      - name: create release
        id: cr
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          tag_name: beta-1.${{github.run_number}}
          release_name: beta-2.${{github.run_number}}
      - name: upload jar to release
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{steps.cr.outputs.upload_url}}
          asset_path: ./lib-main/build/libs/lib-main-1.2.jar
          asset_name: witsTalk-backend-1.${{github.run_number}}.jar
          asset_content_type: application/jar
  forntend:
    name: build witsTalk frontend
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '20.5.0'
      - name: tab
        run: cd web
      - name: Install dependencies
        run: yarn
      - name: Build dependencies
        run: yarn build
      - name: create release
        id: cr
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          tag_name: beta-1.${{github.run_number}}
          release_name: beta-1.${{github.run_number}}
      - name: upload jar to release
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        with:
          upload_url: ${{steps.cr.outputs.upload_url}}
          asset_path: ./web/dist
          asset_name: witsTalk-front-1.${{github.run_number}}.zip
          asset_content_type: application/zip